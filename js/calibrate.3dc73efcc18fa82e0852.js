(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var o=r.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e+"../"})();const e=t.p+"assets/calibrate.9f6c.mp3";function r(t){const e=window.calibrateActx.currentTime-window.actxStartTime;console.log(e);var r=1;e>0&&e<=2&&(console.log("Calibration stage 1",t),r=1),e>2&&e<=4&&(console.log("Calibration stage 2",t),r=2),e>4&&e<=6&&(console.log("Calibration stage 3",t),r=3),e>6&&e<=8&&(console.log("Calibration stage 4",t),r=4),document.querySelector("#result"+r).innerText=Math.round(1e3*(e-(2*r-.5)))}window.addEventListener("DOMContentLoaded",function(){fetch(e).then(t=>t.arrayBuffer()).then(t=>{window.caliBrateAudioArrayBuffer=t}).catch(()=>{alert("错误：无法加载校准音频")})}),document.querySelector("button#startBtn").addEventListener("click",function(){null!=window.caliBrateAudioArrayBuffer?(window.calibrateActx=null,window.calibrateActx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext),window.calibrateActx.decodeAudioData(window.caliBrateAudioArrayBuffer,function(t){window.calibraceACtxSource=window.calibrateActx.createBufferSource(),window.calibraceACtxSource.buffer=t,window.calibraceACtxSource.connect(window.calibrateActx.destination),window.actxStartTime=window.calibrateActx.currentTime,window.calibraceACtxSource.start(0),window.calibraceACtxSource.addEventListener("ended",function(){null==window.calibrateActx||window.calibrateActx.close(),window.calibrateActx=void 0,document.querySelector("button#startBtn").removeAttribute("disabled"),document.querySelector("button#clickBtn").removeEventListener("click",r),window.calibrateActx=null})}),document.querySelector("button#startBtn").setAttribute("disabled","disabled"),document.querySelector("button#clickBtn").addEventListener("click",r)):alert("抱歉，校准音频尚在加载中，请稍后")}),document.body.addEventListener("keydown",()=>{document.querySelector("button#clickBtn").click()}),document.querySelector("button#cancelBtn").addEventListener("click",function(){document.querySelector("button#startBtn").removeAttribute("disabled"),document.querySelector("button#clickBtn").removeEventListener("click",r);try{window.calibraceACtxSource.stop()}catch(t){}const t=parseFloat(document.querySelector("#result1").innerText.replace("-","-0")),e=parseFloat(document.querySelector("#result2").innerText.replace("-","-0")),o=parseFloat(document.querySelector("#result3").innerText.replace("-","-0")),n=parseFloat(document.querySelector("#result4").innerText.replace("-","-0")),c=Math.round((t+e+o+n)/4),i=confirm("谱面延时即将被设置为 "+c+" ，是否确认？\n单击“取消”为继续而不保存");i&&(localStorage.setItem("input-offset",c),location.href="../index.html"),i||(location.href="../index.html")})})();